# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Ç–µ–≥–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ
–°–∏—Å—Ç–µ–º–∞ —Ç–µ–≥–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–æ—Ç–µ. –í–º–µ—Å—Ç–æ –∏–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–µ–∑–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–µ–≥–∏ –≤–∏–¥–∞ `#irl_1`, `#irl_2` –∏ —Ç.–¥.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (#irl_1, #irl_2, ...)
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω –≤ —Ç–æ–ø–∞—Ö
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–≥–æ–≤ –≤ –ø—Ä–æ—Ñ–∏—Ç–∞—Ö
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–º–µ–Ω—ã —Ç–µ–≥–∞ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/changetag`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–≥–æ–≤ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–≥–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç—ã –≤ Supabase SQL Editor –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:

```sql
-- 1. –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ add_tag_system.sql
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–∏—Ç –ø–æ–ª–µ user_tag –∏ —Å–æ–∑–¥–∞—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏

-- 2. –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ cleanup_functions.sql
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

-- 3. –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ update_functions_with_tags.sql  
-- –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–≥–∞–º–∏
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

#### –û—à–∏–±–∫–∞: "cannot change return type of existing function"
–†–µ—à–µ–Ω–∏–µ:
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `cleanup_functions.sql`
2. –ó–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `update_functions_with_tags.sql`

#### –û—à–∏–±–∫–∞: "column user_tag does not exist"
–†–µ—à–µ–Ω–∏–µ:
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ `add_tag_system.sql`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª–µ `user_tag` –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É `users`

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
–ö–æ–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –≤–∫–ª—é—á–∞–µ—Ç:
- –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ `database/db.py`
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ `handlers/chat_commands.py`
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤ `handlers/user_menu.py`
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –ø–∞–Ω–µ–ª–∏

### 3. –ù–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
- `/changetag –Ω–æ–≤—ã–π_—Ç–µ–≥` - —Å–º–µ–Ω–∞ —Ç–µ–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/me` - —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–≥ –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω–∏

### 4. –ü—Ä–∞–≤–∏–ª–∞ —Ç–µ–≥–æ–≤
- –î–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —Å–∏–º–≤–æ–ª–∞ `#`
- –î–ª–∏–Ω–∞ –æ—Ç 3 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤
- –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª `_`
- –ü—Ä–∏–º–µ—Ä—ã: `#irl_boss`, `#worker1`, `#pro_trader`

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –í —Ç–æ–ø–∞—Ö
–í–º–µ—Å—Ç–æ:
```
ü•á @username
ü•à –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤
```

–¢–µ–ø–µ—Ä—å:
```
ü•á #irl_1
ü•à #irl_2
```

### –í –ø—Ä–æ—Ñ–∏–ª–µ
–í–º–µ—Å—Ç–æ:
```
üë§ @username
```

–¢–µ–ø–µ—Ä—å:
```
üè∑ #irl_1
üîß –°–º–µ–Ω–∏—Ç—å —Ç–µ–≥: /changetag –Ω–æ–≤—ã–π_—Ç–µ–≥
```

### –í –∞–¥–º–∏–Ω–∫–µ
–í—Å–µ —Å–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–µ–≥–∏ –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏.

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–°–∫—Ä–∏–ø—Ç `add_tag_system.sql` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∏—Ç —Ç–µ–≥–∏ –≤—Å–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ –ø–æ—Ä—è–¥–∫–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
- –ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç `#irl_1`
- –í—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç `#irl_2`
- –ò —Ç–∞–∫ –¥–∞–ª–µ–µ...

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `/me` - –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–µ–≥
3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `/top` - –¥–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ç–µ–≥–∏
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–º–µ–Ω–∏—Ç—å —Ç–µ–≥: `/changetag #my_new_tag`

## –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é –∏–º–µ–Ω, –º–æ–∂–Ω–æ:
1. –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ
2. –£–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ `user_tag` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users`
3. –£–¥–∞–ª–∏—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```sql
-- –û—Ç–∫–∞—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
ALTER TABLE users DROP COLUMN IF EXISTS user_tag;
DROP FUNCTION IF EXISTS generate_next_tag();
DROP FUNCTION IF EXISTS assign_user_tag();
DROP TRIGGER IF EXISTS trigger_assign_user_tag ON users;
```